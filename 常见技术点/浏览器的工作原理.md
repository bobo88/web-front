# 浏览器的工作原理

*从用户在浏览器地址栏输入网址，到看到整个页面，中间都发生了哪些事情？*

### 一、HTTP请求阶段
- `DNS`解析
- `TCP`协议的三次握手和四次挥手
- `HTTPS` 和 `HTTP（HTTP2）` 的区别
    - 2.0多路复用
- IP地址来进行寻址，排队等待，最多能发送6个HTTP请求

### 二、HTTP相应阶段
- `HTTP`状态码
- `304`缓存
- `HTTP`报文

### 三、浏览器渲染阶段
- 进程 Process
- 线程 Thread
- 栈内存 Stack

备注： 浏览器是多线程的，js是单线程的
- *1、拿到代码后：浏览器在内存条中开辟出一块栈内存，用来给代码的执行提供环境*
- *2、同时分配一个主线程去一行行的解析和执行代码*
- *3、当浏览器遇到link/script/img等请求时，都会开辟全新的线程去加载资源文件 - Task queue任务队列*
- *4、第一次自上而下走完后，只生成DOM树*
- *5、Event Loop 事件循环（找Task queue任务队列中的任务，将完成的任务插入主线程）*
- *6、微任务和宏任务*
- *7、CSS处理完成生成CSSOM*
- *8、DOM树 + CSSOM，合并生成Render Tree渲染树*
    - Layout（回流）：根据生成的渲染树，计算它们在设备视口（viewport）内的确切位置和大小，这个计算的阶段就是回流。
        - 放弃传统操作DOM的时代，基于vue/react开始数据影响视图模式： mvvm/mvc/(virtual dom)/(dom diff)...
        - 分离读写操作（现代的浏览器都有渲染队列的机制）
        - 样式集中改变（批量处理）
    - Painting（重绘）：根据渲染树以及回流得到的几何信息，得到节点的绝对像素
    - Display：将像素发送给GPU，展示到页面上
    - 注意：回流一定会触发重绘，但是重绘不一定会回流
- *9、CPU根据Render Tree渲染树进行页面绘图*
- *10、性能优化：减少HTTP的请求次数以及大小*
    - 资源合并压缩
    - 图片懒加载
    - 音视频走流文件 - m3u8
    - DNS/304缓存
    - ......
